{% extends 'base.html' %}

{% block title %}Search Patient{% endblock %}

{% block content %}
<h2 class="mb-4">Search Patient</h2>
<p class="text-muted mb-3">Enter a patient ID to search for records.</p>
<form method="GET" action="/search">
    <div class="input-group mb-4">
        <input type="number" class="form-control" id="searchQuery" name="query" placeholder="Enter Patient ID" value="{{ query }}" min="0">
        <button class="btn btn-primary" type="submit">
            <i class="bi bi-search"></i> Search
        </button>
    </div>
</form>

{% if patient %}
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">Patient ID: <span class="patient-id-header">{{ patient.id }}</span></h4>
        </div>
        <div class="card-body">
            <!-- Mobile-friendly tabs for different record types -->
            <ul class="nav nav-tabs mb-3" id="recordTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="admission-tab" data-bs-toggle="tab" data-bs-target="#admission" type="button" role="tab">Admission</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily" type="button" role="tab">Daily</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="discharge-tab" data-bs-toggle="tab" data-bs-target="#discharge" type="button" role="tab">Discharge</button>
                </li>
            </ul>

            <div class="tab-content" id="recordTabsContent">
                <!-- Admission Records -->
                <div class="tab-pane fade show active" id="admission" role="tabpanel">
                    <h5 class="mb-3">Admission Records</h5>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th style="font-size: 0.8rem;">ID</th>
                                    <th style="font-size: 0.8rem;">Day</th>
                                    <th style="font-size: 0.8rem;">Date</th>
                                    <th style="font-size: 0.8rem;">Age</th>
                                    <th style="font-size: 0.8rem;">Gender</th>
                                    <th style="font-size: 0.8rem;">Height</th>
                                    <th style="font-size: 0.8rem;">Diagnosis</th>
                                    <th style="font-size: 0.8rem;">KCCQ Score</th>
                                    <th style="font-size: 0.8rem;">Actions</th>
                                </tr>
        </thead>
        <tbody>
            {% for record in records if record.recording_type == 'admission' %}
                <tr>
                    <td>{{ record.id }}</td>
                    <td>{{ record.recording_type|capitalize }}</td>
                    <td>{{ record.hospitalization_day }}</td>
                    <td>{{ record.date.strftime('%d.%m.%Y') if record.date else '' }}</td>
                    <td>{{ record.age }}</td>
                    <td>{{ record.gender }}</td>
                    <td>{{ record.height }}</td>
                    <td>{{ record.diagnosis }}</td>
                    <td>{{ record.medication }}</td>
                    <td>{{ record.comorbidities }}</td>
                    <td>{{ record.admission_date.strftime('%d.%m.%Y') if record.admission_date else '' }}</td>
                    <td>{{ record.ntprobnp }}</td>
                    <td>{{ record.kalium }}</td>
                    <td>{{ record.natrium }}</td>
                    <td>{{ record.kreatinin_gfr }}</td>
                    <td>{{ record.harnstoff }}</td>
                    <td>{{ record.hb }}</td>
                    <td>{{ record.initial_weight }}</td>
                    <td>{{ record.initial_bp }}</td>
                    <td>{{ record.score }}</td>
                    <td>{% if record.voice_sample_standardized %}Ja{% else %}Nein{% endif %}</td>
                    <td>{% if record.voice_sample_storytelling %}Ja{% else %}Nein{% endif %}</td>
                    <td>
                        <a href="{{ url_for('views.edit_recording', recording_id=record.id) }}" class="btn btn-sm btn-warning">Edit</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>

    <h4>Daily</h4>
    <div style="overflow-x:auto;">
    <table class="table table-sm table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Day</th>
                <th>Date</th>
                <th>Weight</th>
                <th>BP</th>
                <th>Pulse</th>
                <th>Medication Changes</th>
                <th>Kalium</th>
                <th>Natrium</th>
                <th>Kreatinin/GFR</th>
                <th>Harnstoff</th>
                <th>Hb</th>
                <th>NTproBNP</th>
                <th>Voice Sample</th>
                <th>Voice Story</th>
                <th>Actions</th>
              
            </tr>
        </thead>
        <tbody>
            {% for record in records if record.recording_type == 'daily' %}
                <tr>
                    <td>{{ record.id }}</td>
                    <td>{{ record.recording_type|capitalize }}</td>
                    <td>{{ record.hospitalization_day }}</td>
                    <td>{{ record.date.strftime('%d.%m.%Y') if record.date else '' }}</td>
                    <td>{{ record.weight }}</td>
                    <td>{{ record.bp }}</td>
                    <td>{{ record.pulse }}</td>
                    <td>{{ record.medication_changes }}</td>
                    <td>{{ record.kalium_daily }}</td>
                    <td>{{ record.natrium_daily }}</td>
                    <td>{{ record.kreatinin_gfr_daily }}</td>
                    <td>{{ record.harnstoff_daily }}</td>
                    <td>{{ record.hb_daily }}</td>
                    <td>{{ record.ntprobnp_daily }}</td>
                    <td>{% if record.voice_sample_standardized %}Ja{% else %}Nein{% endif %}</td>
                    <td>{% if record.voice_sample_storytelling %}Ja{% else %}Nein{% endif %}</td>
                    <td>
                        <a href="{{ url_for('views.edit_recording', recording_id=record.id) }}" class="btn btn-sm btn-warning">Edit</a>
                    </td>
               
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
{% elif query %}
    <p class="text-danger">No patient found with ID {{ query }}.</p>
{% endif %}

{% endblock %}
